#/bin/bash

SRC="config.cc eVizRLEUtil.c io.cc lb.cc main.cc rt.cc topology.cc"
FLAGS="-qstrict -qstrict_induction -O4 -qipa=level=2 -qhot=vector -qcache=auto"
FLAGS="-qstrict -qstrict_induction -O4"
FLAGS="-O4 -qstrict -qstrict_induction -bmaxdata:0x60000000 -qipa=level=2 -qhot=vector -qcache=auto"
FLAGS="-O3 -qstrict -qstrict_induction -bmaxdata:0x60000000"
MPI_CC=mpcc_r
MPIg_CC=/usr/local/packages/mpig-1.0.6-64/bin/mpicxx
MPIg_CC=/work/default/steven/mpig/bin/mpicxx
REG_INCLUDE_FILE=-I/home/steven/RealityGrid/file/reg_steer_lib/include
REG_INCLUDE_GRID=-I/home/steven/RealityGrid/grid/reg_steer_lib/include
REG_LIBS_FILE="-L/home/steven/RealityGrid/file/reg_steer_lib/lib64 -L/opt/freeware/lib -lReG_Steer -lReG_Steer_Utils -lReG_Steer_SOAP -liconv -lxml2 -q64 -brtl"
REG_LIBS_GRID="-L/home/steven/RealityGrid/grid/reg_steer_lib/lib64 -L/opt/freeware/lib -lReG_Steer -lReG_Steer_Utils -lReG_Steer_SOAP -liconv -lxml2 -q64 -brtl"

function BuildHemeLB_MPI_Bench {
echo "Building HemeLB with standard MPI + benchmarking"
$MPI_CC \
	-DBENCH \
	-bmaxdata:0x60000000 \
	$FLAGS $SRC -lm \
	-o hemelb_bench
}

function BuildHemeLB_MPI_Vis {
echo "Building HemeLB with standard MPI + vis output"
$MPI_CC \
	-DRG -DFREEROOT \
	-bmaxdata:0x60000000 \
	$FLAGS $SRC -lm \
	-o hemelb_vis
}

function BuildHemeLB_MPI_Vis_File_Steering {
echo "Building HemeLB with standard MPI + vis output + file-based ReG steering"
$MPI_CC \
	-DRG -DFREEROOT -DSTEER \
	$REG_INCLUDE_FILE \
	$REG_LIBS_FILE \
	-bmaxdata:0x60000000 \
	$FLAGS $SRC -lm \
	-o hemelb_vis_reg_file
}

function BuildHemeLB_MPI_Vis_Grid_Steering {
echo "Building HemeLB with standard MPI + vis output + grid-based ReG steering"
$MPI_CC \
	-DRG -DFREEROOT -DSTEER \
	$REG_INCLUDE_GRID \
	$REG_LIBS_GRID \
	-bmaxdata:0x60000000 \
	$FLAGS $SRC -lm \
	-o hemelb_vis_reg_grid
}

function BuildHemeLB_MPIg_Bench {
echo "Building HemeLB with MPIg + benchmarking"
$MPIg_CC \
        -DBENCH \
	$FLAGS $SRC -lm \
	-o hemelb_mpig_bench
}

function BuildHemeLB_MPIg_Vis {
echo "Building HemeLB with MPIg + vis output"
$MPIg_CC \
        -DRG -DFREEROOT \
        -bmaxdata:0x60000000 \
	$FLAGS $SRC -lm \
	-o hemelb_mpig_vis
}

function BuildHemeLB_MPIg__Vis_File_Steering {
echo "Building HemeLB with MPIg + vis output + file-based ReG steering"
$MPIg_CC \
	-DRG -DFREEROOT -DSTEER \
        -bmaxdata:0x60000000 \
	$REG_INCLUDE_FILE \
	$REG_LIBS_FILE \
	$FLAGS $SRC -lm \
	-o hemelb_mpig_vis_reg_file
}

function BuildHemeLB_MPIg_Vis_Grid_Steering {
echo "Building HemeLB with MPIg + vis output + grid-based ReG steering"
$MPIg_CC \
	-DRG -DFREEROOT -DSTEER \
        -bmaxdata:0x60000000 \
	$REG_INCLUDE_GRID \
	$REG_LIBS_GRID \
	$FLAGS $SRC -lm \
	-o hemelb_mpig_vis_reg_grid
}

rm -f hemelb*

#BuildHemeLB_MPI_Bench
BuildHemeLB_MPIg_Bench
